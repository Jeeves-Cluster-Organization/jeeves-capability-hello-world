# Dockerfile for Jeeves Hello World - General Chatbot
#
# Simple single-stage build for the 3-agent chatbot with Gradio UI.
#
# Build:
#   docker build -f docker/Dockerfile.hello-world -t jeeves-hello-world:latest .
#
# Run (standalone):
#   docker run -p 8000:8000 \
#     -e LLM_PROVIDER=openai \
#     -e OPENAI_API_KEY=your_key \
#     jeeves-hello-world:latest
#
# For full deployment, use docker-compose.hello-world.yml

FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    gcc \
    g++ \
    git \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements files
COPY requirements/base.txt requirements/
COPY requirements/all.txt requirements/

# Install Python dependencies
# Note: For hello-world, we need gradio, structlog, and jeeves-core dependencies
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements/all.txt && \
    pip install --no-cache-dir gradio structlog

# Copy jeeves-core submodule (infrastructure)
COPY jeeves-core/ /app/jeeves-core/

# Copy capability code
COPY jeeves_capability_hello_world/ /app/jeeves_capability_hello_world/

# Copy Gradio application
COPY gradio_app.py /app/

# Create data directory
RUN mkdir -p /app/data

# Set Python path to include jeeves-core
ENV PYTHONPATH=/app:/app/jeeves-core:$PYTHONPATH

# Expose Gradio port
EXPOSE 8000

# Health check endpoint (Gradio provides /health by default)
HEALTHCHECK --interval=15s --timeout=5s --retries=3 --start-period=30s \
  CMD curl -f http://localhost:8000/ || exit 1

# Default environment variables (can be overridden)
ENV LOG_LEVEL=INFO

# Run Gradio application
CMD ["python", "gradio_app.py"]

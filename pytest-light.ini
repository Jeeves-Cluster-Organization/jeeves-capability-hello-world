[pytest]
# Lightweight Test Profile
# For fast testing without heavy dependencies (ML models, Docker, external services)
#
# Usage:
#   pytest -c pytest-light.ini
#
# Or set as default:
#   export PYTEST_CONFIG=pytest-light.ini

# Python path
pythonpath = . jeeves-core

# Test discovery
python_files = test_*.py
python_classes = Test*
python_functions = test_*
testpaths =
    tests
    jeeves-core/jeeves_avionics/tests
    jeeves-core/jeeves_control_tower/tests
    jeeves-core/jeeves_memory_module/tests
    jeeves-core/jeeves_mission_system/tests
    jeeves-core/jeeves_protocols/tests
    jeeves-core/tests
    jeeves-capability-code-analyser/tests

# Output configuration
addopts =
    -v
    --tb=short
    # Skip heavy dependencies
    -m "not heavy and not requires_ml and not requires_docker and not requires_azure and not requires_openai and not e2e"

# Async configuration
asyncio_mode = auto

# Markers (comprehensive list from all layers)
markers =
    # Test categories
    unit: Unit tests with mocked dependencies (fast, no external services)
    integration: Integration tests requiring database or containers
    contract: Constitution/contract validation tests
    e2e: End-to-end tests requiring real LLM and full stack
    slow: Slow-running tests (> 5 seconds)

    # Dependency markers (SKIPPED in lightweight mode)
    heavy: Tests with heavy dependencies (ML models, large downloads)
    requires_ml: Tests requiring ML models (sentence-transformers, etc.)
    requires_docker: Tests requiring Docker/testcontainers
    requires_postgres: Tests requiring PostgreSQL database
    requires_services: Tests requiring full Docker stack (postgres + llama-server)
    requires_full_app: Tests using TestClient with full app lifespan

    # LLM markers (SKIPPED in lightweight mode)
    requires_llamaserver: Tests requiring llama-server (real LLM testing)
    requires_azure: Tests requiring Azure OpenAI credentials
    requires_openai: Tests requiring OpenAI package and API key
    requires_anthropic: Tests requiring Anthropic package and API key
    uses_llm: Tests that use LLM (requires real llama-server)
    requires_llm_quality: Tests requiring capable LLM (7B+) for nuanced NLP tasks

    # WebSocket markers (SKIPPED in lightweight mode)
    websocket: WebSocket tests (requires services to be available)

    # V2 Memory markers
    v2_memory: V2 memory infrastructure tests
    v2_open_loops: V2 open loops specific tests

    # Production markers (SKIPPED in lightweight mode)
    prod: Production tests (requires API keys, set PROD_TESTS_ENABLED=1)

# Logging
log_cli = false
log_cli_level = WARNING

# Coverage (optional - uncomment to enable)
# addopts = --cov=jeeves_core_engine --cov=jeeves_avionics --cov=jeeves_mission_system --cov-report=html

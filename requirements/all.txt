# ============================================================================
# Unified Requirements - For local development (includes optional deps)
# ============================================================================
#
# DOCKER BUILDS: The Dockerfile uses split requirements for optimization:
#   - requirements-base.txt        → Shared (pydantic, structlog, grpc)
#   - requirements-gateway.txt     → Gateway only (~200MB image)
#   - requirements-orchestrator.txt → Core orchestrator (~2.5GB image)
#   - requirements-optional.txt    → Cloud providers, monitoring
#   - requirements-test.txt        → Test dependencies
#
# BAREMETAL (llama-server only):
#   pip install -r requirements-orchestrator.txt
#
# LOCAL DEVELOPMENT (full):
#   pip install -r requirements.txt
#
# PostgreSQL Setup:
# - For podman-compose: pip install podman-compose
# - For PostgreSQL client (psql): sudo dnf install postgresql (Fedora/RHEL)
#                                  sudo apt install postgresql-client (Ubuntu/Debian)
# ============================================================================

# Web framework
fastapi==0.109.0
uvicorn[standard]==0.24.0

# Database - PostgreSQL with pgvector
sqlalchemy[asyncio]>=2.0.0,<3.0.0  # Async ORM
asyncpg>=0.29.0  # Async PostgreSQL driver
pgvector>=0.2.0  # pgvector Python client

# Embeddings (HEAVY: pulls PyTorch ~1.5GB, transformers ~500MB)
# Only needed by orchestrator for L3 semantic memory
numpy>=1.24.3,<3.0.0
sentence-transformers>=3.0.0,<6.0.0

# NLI (Natural Language Inference) for claim verification
# Per Constitution P1: Anti-hallucination gate in Critic agent
transformers>=4.30.0

# Utilities
pydantic>=2.5.0,<3.0.0
pydantic-settings>=2.0.0
structlog==23.2.0

# HTTP client for llama-server provider
httpx==0.27.2

# gRPC (internal RPC layer)
grpcio>=1.60.0
grpcio-tools>=1.60.0
grpcio-health-checking>=1.60.0  # Standard health check protocol

# ============================================================================
# Testing (only needed for development/CI)
# ============================================================================
pytest==7.4.3
pytest-asyncio==0.21.1
pytest-cov==4.1.0
pytest-timeout>=2.0.0
websockets>=12.0  # WebSocket client for gateway tests
testcontainers[postgres]>=3.7.0  # PostgreSQL test containers

# ============================================================================
# OPTIONAL: Cloud providers and monitoring
# These have graceful fallbacks - NOT required for llama-server deployment
# ============================================================================
prometheus-client==0.19.0  # Monitoring (fallback: noop metrics)
openai>=1.0.0              # OpenAI/Azure providers (fallback: RuntimeError if used)
# anthropic>=0.18.0        # Anthropic/Claude (uncomment if needed)
